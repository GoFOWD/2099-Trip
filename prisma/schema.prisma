generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model Schedule {
  id           String         @id @default(cuid())
  startDate    DateTime
  endDate      DateTime
  userId       String
  companion    Int?
  AirTicket    AirTicket[]
  budgets      Budget[]
  city         City?
  Hotel        Hotel[]
  User         User           @relation(fields: [userId], references: [id])
  ScheduleItem ScheduleItem[]
  Tour         Tour[]
  visitCountry VisitCountry[]
}

model VisitCountry {
  id          String   @id @default(cuid())
  countryCode String
  startDate   DateTime
  endDate     DateTime
  scheduleId  String
  nameKo      String?
  schedule    Schedule @relation(fields: [scheduleId], references: [id], onDelete: Cascade)
}

model City {
  id         String   @id @default(cuid())
  cityName   String
  cityCode   String
  scheduleId String   @unique
  schedule   Schedule @relation(fields: [scheduleId], references: [id], onDelete: Cascade)
}

model AirTicket {
  id         String   @id @default(cuid())
  price      Int
  airline    String
  tripType   TripType
  scheduleId String

  Schedule Schedule        @relation(fields: [scheduleId], references: [id])
  segments flightSegment[]
}

model flightSegment {
  id               String    @id @default(cuid())
  departurePort    String
  airportName      String
  arrivalPort      String
  departureCountry String
  departureCity    String
  arrivalCountry   String
  arrivalCity      String
  departureDate    DateTime
  arrivalDate      DateTime
  flightNumber     String
  airTicketId      String
  airTicket        AirTicket @relation(fields: [airTicketId], references: [id])
}

model User {
  id                   String     @id @default(cuid())
  email                String     @unique
  password             String
  name                 String?
  haveReservedAirLine  Boolean    @default(false)
  haveReservedionHotel Boolean    @default(false)
  haveReservedTour     Boolean    @default(false)
  createdAt            DateTime   @default(now())
  countries            Country[]
  diaries              Diary[]
  schedules            Schedule[]
}

model Tour {
  id         String   @id @default(cuid())
  reservedAt DateTime
  location   String
  latitude   Float
  longitude  Float
  rating     Float?
  price      String?
  scheduleId String
  countryId  String?
  country    Country? @relation(fields: [countryId], references: [id])
  schedule   Schedule @relation(fields: [scheduleId], references: [id], onDelete: Cascade)
}

model Diary {
  id        String   @id @default(cuid())
  title     String
  content   String
  date      String
  pic       String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  authorId  String
  latitude  Float?
  location  String?
  longitude Float?
  author    User     @relation(fields: [authorId], references: [id])
}

model Hotel {
  id         String    @id @default(cuid())
  name       String
  price      Float?
  rating     Float?
  checkIn    DateTime?
  checkOut   DateTime?
  location   String
  countryId  String?
  scheduled  String?
  scheduleId String
  schedules  Schedule  @relation(fields: [scheduleId], references: [id])
  amenities  Amenity[] @relation("AmenityToHotel")
}

model Amenity {
  id          String  @id @default(cuid())
  Amenityname String
  hotels      Hotel[] @relation("AmenityToHotel")
}

model Budget {
  id                      String   @id @default(cuid())
  airTicketPlan           Int
  hotelPlan               Int
  actualHotelSpending     Int
  totalBudget             Int
  actualAirTicketSpending Int
  actualTourSpending      Int
  otherSpending           Int
  scheduleId              String
  schedule                Schedule @relation(fields: [scheduleId], references: [id], onDelete: Cascade)
}

model Country {
  id              String  @id @default(cuid())
  countryCode     String  @unique
  name            String
  nameKo          String?
  description     String?
  embassyLocation String?
  emergencyNumber String?
  userId          String?

  cautions  Caution[]
  User      User?             @relation(fields: [userId], references: [id])
  languages CountryLanguage[]
  tours     Tour[]

  @@index([name])
  @@index([nameKo])
}

model Language {
  id        String            @id @default(cuid())
  code      String            @unique
  name      String
  countries CountryLanguage[]
}

model CountryLanguage {
  countryId  String
  languageId String
  isOfficial Boolean  @default(false)
  notes      String?
  country    Country  @relation(fields: [countryId], references: [id], onDelete: Cascade)
  language   Language @relation(fields: [languageId], references: [id], onDelete: Cascade)

  @@id([countryId, languageId])
  @@index([languageId])
}

model Caution {
  id        String  @id @default(cuid())
  countryId String
  title     String
  content   String
  country   Country @relation(fields: [countryId], references: [id], onDelete: Cascade)

  @@index([countryId])
}

model ScheduleItem {
  id         String   @id @default(cuid())
  title      String
  location   String?
  datetime   DateTime
  scheduleId String
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  schedule   Schedule @relation(fields: [scheduleId], references: [id], onDelete: Cascade)

  @@index([scheduleId, datetime])
}

enum TripType {
  ONE_WAY
  ROUND_TRIP
}
